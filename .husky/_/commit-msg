#!/usr/bin/env sh

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

PATTERN='^\[#[0-9]{4}\] (Chore|CVE|Feature|Bug): .{5,}'

if ! echo "$COMMIT_MSG" | grep -qE "$PATTERN"; then
  echo "❌ Invalid commit message format!"
  echo ""
  echo "Expected format:"
  echo "  [#0000] Type: Your message"
  echo ""
  echo "Rules:"
  echo "  - Story number must be EXACTLY 4 digits (e.g., #0001, #1234)"
  echo "  - Type must be one of: Chore, CVE, Feature, Bug"
  echo "  - Message after colon must be at least 5 characters"
  echo ""
  echo "Valid examples:"
  echo "  [#1234] Feature: Add user authentication"
  echo "  [#0056] Bug: Fix login redirect"
  echo "  [#0001] Chore: Update dependencies"
  echo "  [#0789] CVE: Bump assertj-core version"
  echo ""
  echo "Invalid examples:"
  echo "  [#1] Feature: Message           ❌ Not 4 digits"
  echo "  [#000001] Bug: Message          ❌ Too many digits"
  echo "  [#1234] Chore: 1234             ❌ Message too short (<5 chars)"
  echo ""
  exit 1
fi

echo "✅ Commit message format valid"
