tasks.register('formatProject') {
    group = 'formatting'
    description = 'ðŸŽ¨ Format and fix all code (frontend + backend)'

    doFirst {
        println("ðŸš€ Formatting entire project...")
        println("ðŸ”§ Starting backend formatting...")
    }

    dependsOn 'spotlessApply'
}

tasks.register('backendComplete') {
    dependsOn 'spotlessApply'

    doLast {
        println("âœ… Backend formatting complete!")
        println("ðŸ’… Starting frontend formatting...")
    }
}

tasks.register('formatFrontend', Exec) {
    group = 'formatting'
    description = 'Format frontend code'

    dependsOn 'backendComplete'

    workingDir = project.file('frontend')
    if (System.getProperty('os.name').toLowerCase().contains('windows')) {
        commandLine 'cmd', '/c', 'yarn', 'format'
    } else {
        commandLine 'yarn', 'format'
    }

    doLast {
        println("âœ… Frontend prettier formatting complete!")
    }
}

tasks.register('lintFixFrontend', Exec) {
    group = 'formatting'
    description = 'Auto-fix frontend linting issues'

    dependsOn 'formatFrontend'

    workingDir = project.file('frontend')
    if (System.getProperty('os.name').toLowerCase().contains('windows')) {
        commandLine 'cmd', '/c', 'yarn', 'lint:fix'
    } else {
        commandLine 'yarn', 'lint:fix'
    }

    doLast {
        println("âœ… Frontend ESLint formatting complete!")
    }
}

tasks.register('finishFormatting') {
    dependsOn 'lintFixFrontend'

    doLast {
        println("âœ¨ Project formatting complete!")
        println("ðŸŽ¯ All code has been formatted and linted")
    }
}

formatProject.finalizedBy 'finishFormatting'
